#basic dirs
sudo apt-get --assume-yes install git python-dev build-essential python-pip libssl-dev libffi-dev

mkdir /home/pi/bpm_run
mkdir /home/pi/bpm_run/device


mkdir /home/pi/.ssh

echo '-----BEGIN RSA PRIVATE KEY-----
MIIJKAIBAAKCAgEAzDzEszTJEZaD4qf7GL9YjUgihQJ3Bnt+cnuG6+4hMyUnEimQ
Ui37nrSPb0g/fX+6V/niynpBF0rAaeAdIs/rJujU1isjiThWPhCgFWmy2SagXdEx
SIlh6IGF07ajyKs37KCosiZ/or4t3HvCL9PfMN296wLXcWV1/jLsFZaPPV+mlrMA
/hBiN7QapUhI/CKXfXR800wucuf1lYVzeQKKNaTPGnVKyFg8LAPMzrrz1eYLaXMM
GEWj2JmmOfOdRaF32JTxIc5ii8XPiqL3PExVy2i7MtC7EQXjOm0T8hv5HEj1olri
WMqtrl+u1I5bwtErHiWxT68ARuzLWwhAXvpQmX/0Pe4RLMLOuLbpQFms3uY76BrZ
0u+hmK1FbRm9t1P6RHfYlx4OWDuaf3H+QBz062zZIHTr/NEdxENh/3LK6piPugfO
vXHQuHiH5HqVMo779ghx6UGrppsmCD1T9ZvRKqzPPsxpz7qD15lTUq8VLy5SS5zW
gaSzXfv/sqb6W9RrbzL/twClunL2D+Bk0bvEBgmKml/qssxqRMxTMb/oSwL+QNiA
HoH3haaxjkYj8I5wIx47vZwruD5vRTI3LkYPZkk/C01ZJxDEPOnlvEbQ/P1+qa0E
LkyTkDIfF82FsdNuDoPhVcngg6/qI5xDs625oAfEC84nn+JVj0kwKGYGqykCAwEA
AQKCAgEAue6MqBTjA+cB9AM3XgU8yYolGu/uifE9YV3Bq+HjSZuGIUvDfn0sOARr
HEUqv8bbTyJH7Es2HM1JtFl6TOn6SzbmJH+rX03xfZlHE5dhYb1/e0lp0352quPX
gLEiFBqD1CFC0sSnp/H48GOemkoJQ4RrVJsGpc5Xh+617MVfa+E7WLBns+QYdlu5
ckUHZLrdLTIyPW56TtOLSO7v+/dq+YErpgun5BIn3W4sMvwR5eYC96HsHeCwVA01
PkbhI7Xm1D5r83nfTx3rXmwUJkncRUz4Nz+9PbcdcWBCK0R6Gdz1+jNBItKJIVks
YYekVAx2c4CfFkrcNrV2QE6Xw5+gZSvfThEX19Bi5aSVA/7FABm+D6ffy39wy+mq
20i1rBQ9u12pcMFtM+mFODlBZwnFitKopmsAeE5azTPFJeJQ26v1kP3fIXxhMhky
ZVm2yPpPT1U/Fd90m1Ge9KDBA2V+gNA7kQ2SW8QuAXU/zpM4oCAFAzFNbCxE/wso
tLsay/YWI7gU6hH4f7qJJ8tgZGQeiRmCqb90grPIOc2Jau5gVeu/CkuCmXfNzKAZ
xcs1Nt0RRKKKQwayoqx+BNMsjSv3tiSBhM2t4ZUKCoKQgGAXStsWjAuPRldK84Re
hmCuKb+CkGeirGXnD3QDm0VZtv0L8/1YxZw66pvQWbOfzbNHQQECggEBAPtBLvvH
8CucXuxJUWDZP1BwcD0hQu08/PlONmzeD7CVCTH2IhhXYNetuvU+UcvKfOyptyDX
YiZ9SnCcKFGm/9w8xMNKVVUKXPYN48C/y05YP7WxBXJa4l3ghA7DwfRn4jHVdcYE
wtqNHsf/fjrYGsgnf34MUalaoIao1pRK+Pg+VFj0yp8o7Hwl/rJ8p0CQ4bJCcBUZ
M/suyq5BfyE2AMy0pRId39EjyghukOTBVev0XjxWlDjJBcS6UDwJMeKXmOT+kvCZ
MFG6bmZB5Igk73DwozHgYhmTmjBNedErkLKIwMQedntlUg+QGJOiFP7h5jl9CO/J
Eb1hfWtz5Jl82UkCggEBANAYQaGtA7p30FfkH8jfgUw3Tm0YUE2m2yuGSy7G3AHn
mGTQMre51d8+xy4Lud7J4NX+hJA8zZPD47RBYJYiKX0nhMDXdiZMIyCX7tDXEcjI
xwH1+Ygal6GtuIfN30/92phQeYQ4PYi83M2hyQlE2DAznSx0B/V4y4gKHqmGVPMs
nL7CXsGHk16HmDqaO9bpMr/HvdAGKfLw3vbgVstKC2CymERbWYcaPtjx3VzgI4Ew
25yFwiKpKJY4ZzTuM8EeZkDm0344HN67RTubSG5AbYgnr4hPpTpg80SqG9zzLeC1
dBT4oZO+vwPwrp6PMaAmvpE2VDIgjNHVNVi7e4bwIuECggEAXPUt49uCQTBWckdi
A1n9Mc6XyBYhQ9K3qalFO5wg4+0P/NsanDTf0IwnSornCmX9ODZGWbE2UBU00FsG
E8ecjCgziCldTtxJroNPC0Yqeu7ti1RWNovnimIBmdDVVo6Ewnk+XKfwS5nAlLAz
TKQdrIXohoMaR3UPRSL8WNswJ/AvlsXinWYvsHMCO5kg7CNuTVyFSVkMwVb7h+MV
nPz06MfA9uX0o9UA74OwueHJ30WHA/3oUuYU60cfXkbsnPAHklmZlcinduVp6Q1h
9vjrWba+OjrRMLNKbaqMclYS7+rmnujCXz8KUFW4sg5ahD6hxg07nDOhC5chJvs2
zY7CeQKCAQBnejhguhUpi1zZ58F6dNHp4XKpQzbjdj50RUJrj01l0RFxyCoAPHPC
oIgROJmD1KVuJDMtOl8LxJQdVYk+/tvctWMJNds1rhSlp4eE5/2a92QmcHdWG8sd
BbLGLTSHpXcm2JWkjwbiUPAHfRTn/Aj45yGYMlam1Rt4mXen2vmxNpT3MtZFrDI3
BnxHX9yzwKCQxzV3FSmU+fwVjXb7feVsf0LCcx5w1Tc9UABAp+Bf5Li/+6+O5skc
8g04P98SgBhe26l9kU+h3kPOISiCUp1k4D8kLF7ASeeOVHyogXBl1jVUHFLUkjyQ
LAXZKOGHftyyfu6dQpxj137AkfIaJp1hAoIBABrQDK9hoeU1rCz6mBIeNJsgG3PB
xoi1kf+mdXNePvqjPKGUxNIfkDa/TuVD0uP2DPpFQHFQGUTIrd1O8j5PsDk+BqUw
hAm0vZmpwGarl35ayFoWYc2SB01JFxskvq/c66D5mkUJh1aRROjMrEOYDFEDIseI
ljOqmWLBXphCPCx+HwL4/Jbr5GbV/VUdY1dDz6IteLecdByRSBQBcCSCI7KaSuTA
kb2QP7aF1R0DHT9Q/AxHfSTkeqoWqt2j+l+l9R/uvGRCaZ6LYOufK3r5Mbyc2E2+
4x9mZsVpXTxwDWWcqiJdDnw7jdBX6qGG7UdgOU3Ng0rv2xml7OkS1lXkp0A=
-----END RSA PRIVATE KEY-----' > /home/pi/.ssh/id_rsa

echo '[user]
	name = pi
	email = pi@nerves' > /home/pi/.gitconfig

cd /home/pi/bpm_run
git clone git@github.com:GabeWeiss/GoogleIoTCoreApp.git

cd /home/pi/bpm_run/GoogleIoTCoreApp/pi_py

sudo chmod +x startup_utils/start_python.sh


#device setup
cd /home/pi/bpm_run/GoogleIoTCoreApp/pi_py

cp startup_utils/device_config_TEMPLATE.json /home/pi/bpm_run/device/device_config.json
#edit device config

cd /home/pi/bpm_run/device
openssl genrsa -out rsa_private.pem 2048
openssl rsa -in rsa_private.pem -pubout -out rsa_public.pem
cat rsa_public.pem


#util script
cd /home/pi/bpm_run/GoogleIoTCoreApp/pi_py
sudo cp startup_utils/bpm.service /lib/systemd/system/bpm.service
sudo chmod 644 /lib/systemd/system/bpm.service

sudo systemctl daemon-reload
sudo systemctl enable bpm.service


#c/p or scp the pub key
#remember to reboot

#sudo reboot
